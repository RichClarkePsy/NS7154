<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Week 2 - Basic visualisation | NS7154 R Workbook</title>
<meta name="author" content="Dr Richard Clarke">
<meta name="description" content="5.1 Introduction This week, I want to introduce you to the data visualisation package ggplot2 (which is contained within the tidyverse). ggplot is an incredibly versatile way of creating graphs...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="Chapter 5 Week 2 - Basic visualisation | NS7154 R Workbook">
<meta property="og:type" content="book">
<meta property="og:description" content="5.1 Introduction This week, I want to introduce you to the data visualisation package ggplot2 (which is contained within the tidyverse). ggplot is an incredibly versatile way of creating graphs...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Week 2 - Basic visualisation | NS7154 R Workbook">
<meta name="twitter:description" content="5.1 Introduction This week, I want to introduce you to the data visualisation package ggplot2 (which is contained within the tidyverse). ggplot is an incredibly versatile way of creating graphs...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="www/webex.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">NS7154 R Workbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome</a></li>
<li><a class="" href="week-1---why-learn-r.html"><span class="header-section-number">2</span> Week 1 - Why learn R?</a></li>
<li><a class="" href="week-1---getting-started.html"><span class="header-section-number">3</span> Week 1 - Getting started</a></li>
<li><a class="" href="week-1---writing-and-running-your-first-code.html"><span class="header-section-number">4</span> Week 1 - Writing and running your first code</a></li>
<li><a class="active" href="week-2---basic-visualisation.html"><span class="header-section-number">5</span> Week 2 - Basic visualisation</a></li>
<li><a class="" href="week-3---working-with-data-files.html"><span class="header-section-number">6</span> Week 3 - Working with data files</a></li>
<li><a class="" href="week-4---working-with-catagorical-variables.html"><span class="header-section-number">7</span> Week 4 - Working with catagorical variables</a></li>
<li><a class="" href="week-5---simple-linear-regression.html"><span class="header-section-number">8</span> Week 5 - Simple Linear Regression</a></li>
<li><a class="" href="week-6---catch-up-week.html"><span class="header-section-number">9</span> Week 6 - Catch up week</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="week-2---basic-visualisation" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Week 2 - Basic visualisation<a class="anchor" aria-label="anchor" href="#week-2---basic-visualisation"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>This week, I want to introduce you to the data visualisation package <code>ggplot2</code> (which is contained within the <code>tidyverse</code>). <code>ggplot</code> is an incredibly versatile way of creating graphs and has become the standard throughout academic publishing and data journalism.</p>
<div class="webex-solution">
<button>
The proliferation of ggplot
</button>
<p>Here is a <a href="https://medium.com/bbc-visual-and-data-journalism/how-the-bbc-visual-and-data-journalism-team-works-with-graphics-in-r-ed0b35693535">link</a> to a post from the BBC talking about how they recently moved to using <code>ggplot</code> for all their data visualisations</p>
<p>Soon, you'll be spotting figures everywhere and start saying to yourself <em>"I bet I could recreate that with ggplot"</em>, and then get sad when you find out they didn't share the data :-(</p>
</div>
<p>For the following examples and exercises, we'll be using a 2015 country-level summary of World Health Organisation data related to life expectancy (<a href="https://www.kaggle.com/datasets/kumarajarshi/life-expectancy-who">source</a>). Next week, I will show you how to read in your own data files but for now I've given you the code that imports the dataset directly from my GitHub (the web hosting system that I use for this book).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run this code to get the data for this week</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">who_rawdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/RichClarkePsy/Datasets/main/Life%20expectancy%20dataset.csv"</span><span class="op">)</span> </span></code></pre></div>
<p>This week you will need the following packages:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># contains the ggplot2 package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span> <span class="co"># used later to add text labels to data points</span></span></code></pre></div>
<div class="webex-solution">
<button>
Reminder about packages
</button>
<p>Remember if you are using any of these packages for the first time you will need to run <code>install.packages("packagename")</code>. It is often best to run this in the console just so you're not re-installing the package each time you run your code.</p>
<p>Note the quotation marks around the package name. R is quite sensitive to this sort of precision and, as such, attention to detail ends up solving most of the errors you get. Either that or just ask ChatGPT to do it for you. Both completely legitimate ways to code!</p>
<p>If you've worked your way through the content from last week, then you'll already have <code>tidyverse</code> installed but you'll likely need to install <code>ggrepel</code>.</p>
</div>
<div id="feeling-overwhelmed" class="section level3" number="5.1.1">
<h3>
<span class="header-section-number">5.1.1</span> Feeling overwhelmed?<a class="anchor" aria-label="anchor" href="#feeling-overwhelmed"><i class="fas fa-link"></i></a>
</h3>
<p>Throughout this week there is going to be chucks of code where you have little to no clue what is going on. That's ok! One of the best ways to learn R is to just play around with pre-existing code, change parts and see what happens. If you run into errors that you don't understand, or code you want explained, just copy and paste it into a ChatGPT conversation and it will explain it to you (I've included an example of this later). You can even ask follow up questions or ask it to adapt the code to your specifications. Though it does help to know at least a little about what your code is doing, especially later on in the course when we move on to analysis.</p>
</div>
</div>
<div id="getting-an-overview-of-your-data" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Getting an overview of your data<a class="anchor" aria-label="anchor" href="#getting-an-overview-of-your-data"><i class="fas fa-link"></i></a>
</h2>
<p>By this point you should have your packages loaded and have a data object in the top right <em>Environment</em> window named <code>who_rawdata</code>. Just by looking at the data object in the environment window we can see two aspects of the dataset; the number of observations and the number of variables. Observations in this case are the individual countries and variables are the various health and social data variables.
Click on the dataset or run <code>view(who_rawdata)</code> to take a look at the data. When you do this, a new tab will appear with a view similar to this:</p>
<div class="inline-figure"><img src="Images/Data%20view.PNG" width="100%" style="display: block; margin: auto;"></div>
<p>Viewing your data like this is good for a quick look at the data, however, in health we are often using datasets with many hundreds of variables and thousands of observations. So we won't be looking at the data directly as much as we might when using SPSS. Instead we want to get into the habit of exploring the dataset through code.</p>
<p>The following gives you some basic information about the dataset in the console. <em>You may want to increase the size of the console window and scroll up and down to see the full information</em>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">who_rawdata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">who_rawdata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">who_rawdata</span><span class="op">)</span></span></code></pre></div>
<p>From viewing the output of the above code...</p>
<p>What is the variable name for life expectancy? <input class="webex-solveme nospaces" size="8" data-answer='["Life_exp"]'></p>
<p>Name a variable that has letters and numbers as data. This is known as character (chr) data <input class="webex-solveme nospaces" size="9" data-answer='["Country","Continent"]'></p>
<p>What is the average number of years of schooling across all countries? <input class="webex-solveme nospaces" size="5" data-answer='["12.93"]'></p>
</div>
<div id="visualising-global-life-expectancy" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Visualising global life expectancy<a class="anchor" aria-label="anchor" href="#visualising-global-life-expectancy"><i class="fas fa-link"></i></a>
</h2>
<p>Statistics are great (and if you've done the undergraduate here you know I love them!), but often, when we want to get a quick and easy understanding of a dataset, we can get everything we want from simple data visualisation.</p>
<div id="histograms" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Histograms<a class="anchor" aria-label="anchor" href="#histograms"><i class="fas fa-link"></i></a>
</h3>
<p>Histograms are a good first step towards understanding a continuous variable like life expectancy. To create a histogram we're going to take our dataset then we're going to <em>pipe</em> <code>%&gt;%</code> it in to the <code>ggplot</code> function.</p>
<div class="webex-solution">
<button>
Extra details on pipes %&gt;%
</button>
<p>A pipe is basically a way of saying "and then" in code. It helps tidy things up so that we're not creating object after object. So in this case we're saying: take the data <em>and then</em> use that data with the following ggplot expression.</p>
<p>This can all be done in a single line of code, however, its a lot neater to hit enter after each pipe and start the next expression on the next line. It also indents for ease of navigation. This is part of the grammar of coding that you'll get use to in time.</p>
<p>You'll see the code for pipes like this <code>%&gt;%</code> through this module but this <code>|&gt;</code> also does the same job. <a href="https://www.r-bloggers.com/2021/05/the-new-r-pipe/">The difference is far too nerdy for any of us to care about</a> right now, but just know that they both do basically the same thing.</p>
<p>For most of this book you can just adapt the code I have given you, and you'll get more used to the notation like this in time.</p>
</div>
<p>Each ggplot visulisation is made up of layers. You start by mapping an aesthetic (<code>aes</code>), which involves the organisation of which data goes on which axis and how data is segmented within the visualisation. Then you layer on (using a <code>+</code> sign) a geometry to combine the data with a desired visual format. The following example takes our data, <em>then</em> places life expectancy on the x-axis, and uses the histogram geometry.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%201.png" width="100%" style="display: block; margin: auto;"></div>
<p>This histogram is fine for a quick exploration of the data, but we could also tidy the figure up to the point at which it would be perfectly fine to include it in a paper.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                 colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                 fill <span class="op">=</span> <span class="st">"#58A139"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 1. Histogram of Global Life Expectancy"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"N = 183 countries"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Life expectancy from birth"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of countries"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Year: 2015 | Data source: WHO"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%202.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="test-yourself-exercise-1" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Test yourself exercise 1<a class="anchor" aria-label="anchor" href="#test-yourself-exercise-1"><i class="fas fa-link"></i></a>
</h3>
<p>Take the above code and adapt it to work out what each of the <em>arguments</em> (e.g. "binwidth" or "subtitle") control. Colours can be in words or in hex codes. Here's a useful website where you can get hex codes <a href="https://htmlcolorcodes.com/">www.htmlcolorcodes.com</a>.</p>
<div class="webex-solution">
<button>
None of this is magic btw
</button>
<p>I don't keep all of this in my head at all times. At some point or other I've <em>Googled</em> how to do pretty much every element here.</p>
<p>Try searching online for the following and see if you can find similar looking code:</p>
<ul>
<li>"Change the colour of histogram bars in ggplot"</li>
<li>"Add a caption to a ggplot figure"</li>
<li>"Align caption to center in ggplot"</li>
</ul>
<p>Also <a href="https://chat.openai.com/share/9831a115-fdde-4643-89b3-e3d0c97d251a">here's a conversation with ChatGPT</a> where it makes some changes to this final version and then suggests some genuinely helpful additions (dotted gridlines are a nice touch).</p>
</div>
</div>
<div id="facet-wrap" class="section level3" number="5.3.3">
<h3>
<span class="header-section-number">5.3.3</span> Facet wrap<a class="anchor" aria-label="anchor" href="#facet-wrap"><i class="fas fa-link"></i></a>
</h3>
<p>This is a good starting visualisation, but say we want to understand the distribution for each region. To do this all we need to do is add the last line of the code below to create a nicely formatted version of the six histograms together.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                 colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                 fill <span class="op">=</span> <span class="st">"#58A139"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 1. Histogram of Global Life Expectancy"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"N = 183 countries"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Life expectancy from birth"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of countries"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Year: 2015 | Data source: WHO"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Continent</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%203.png" width="100%" style="display: block; margin: auto;"></div>
<div class="webex-solution">
<button>
Note about ~
</button>
<p>The <code>~</code> is often used in R to denote a relationship. You'll often see it in regression analysis but in this case it's telling <code>ggplot</code> to facet (i.e. seperate) the graph by the variable <code>Continent</code>.</p>
</div>
</div>
<div id="boxplots" class="section level3" number="5.3.4">
<h3>
<span class="header-section-number">5.3.4</span> Boxplots<a class="anchor" aria-label="anchor" href="#boxplots"><i class="fas fa-link"></i></a>
</h3>
<p>The above histograms definitely have value (for instance we can now see the difference in life expectancy between Europe and Africa very clearly), but a better way to visualise the same data might be to change from a histogram to a boxplot.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Life_exp</span>, y<span class="op">=</span><span class="va">Continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%204.png" width="100%" style="display: block; margin: auto;"></div>
<p>Much better, instantly we can see how the distribution of life expectancy differs across continents. A few things spring to mind to make this figure more informative.
1. Label the outliers (it'd be nice to know what countries they are).
2. Add some colour.
3. Add a title and label the x-axis.</p>
<p>The first point is genuinely quite hard to solve and involves the two lines of code below.</p>
<p>The first line creates a new function that can be used to identify outliers in a variable. Then, in the next line, I use the function to make a new variables where ever time the function finds an outlier in <code>Life_exp</code> it assigns the text from the <code>Country</code> variable.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">findoutlier</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">.25</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">.75</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>   </span>
<span></span>
<span><span class="va">who_with_outliers</span> <span class="op">&lt;-</span> <span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>outlier_LE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">findoutlier</span><span class="op">(</span><span class="va">Life_exp</span><span class="op">)</span>, <span class="va">Country</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Also, because I've made a change to the data (in this case added a new variable) I've assigned it to a new object name, as I always try to keep the raw data in the same form as it was read in. Just in case I need to use it again later. Notice that you should have a new dataframe object in the environment window after running this.</p>
<p>To add these outlines to the figure I've added a layer of text above the box plot layer.</p>
<p>For points two and three I've selected a pre-existing colour pallet and mapped it to our <code>Continent</code> variable and I've added labels with the <code>labs</code> function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_with_outliers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Life_exp</span>, y<span class="op">=</span><span class="va">Continent</span>, fill <span class="op">=</span> <span class="va">Continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>               show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">outlier_LE</span><span class="op">)</span>,</span>
<span>                  position <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 2. Boxplot of Global Life Expectancy"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"N = 183 countries"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Life expectancy from birth"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Year: 2015 | Data source: WHO"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%205.png" width="100%" style="display: block; margin: auto;"></div>
<p>Now that is a good looking figure!</p>
<p>There's a lot going on to make these figures but luckily you don't need to keep it all in your head at one time. I often go back to old code or code from webbooks like this or <a href="https://psyteachr.github.io/">PsyTeachR</a> and adapt and change it for my needs.</p>
<p>In fact lets adapt this code for BMI instead of life expectancy.</p>
</div>
<div id="test-yourself-exercise-2" class="section level3" number="5.3.5">
<h3>
<span class="header-section-number">5.3.5</span> Test yourself exercise 2<a class="anchor" aria-label="anchor" href="#test-yourself-exercise-2"><i class="fas fa-link"></i></a>
</h3>
<p>Adapt the code above to make a histogram and boxplot for the <code>BMI</code> variable instead of life expectancy.</p>
<p>Note: Here is the code for calculating the outliers for BMI, as this requires adding in the extra line <code>drop_na(BMI)</code>. This tells R to remove any missing data in the variable <code>BMI</code>. Note the change in dataset name as well.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">findoutlier</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">.25</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">.75</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">who_BMI</span> <span class="op">&lt;-</span> <span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>outlier_BMI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">findoutlier</span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span>, <span class="va">Country</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="webex-solution">
<button>
Hint
</button>
<p>After running the code above you'll need to start with the data_BMI file rather than the rawdata.</p>
<p>Look to see all the parts of the code that say <code>Life_exp</code> and change these out for <code>BMI</code></p>
<p>Make sure you remember to change the title and axes labels.</p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<p>This is one way the histogram could look:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_BMI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">BMI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                 colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                 fill <span class="op">=</span> <span class="st">"#58A139"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 1. Histogram of Body Mass Index"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"N = 183 countries"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"BMI"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of countries"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Year: 2015 | Data source: WHO"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%206.png" width="100%" style="display: block; margin: auto;"></div>
<p>And this is one way the boxplot could look:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_BMI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">BMI</span>, y<span class="op">=</span><span class="va">Continent</span>, fill <span class="op">=</span> <span class="va">Continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>               show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">outlier_BMI</span><span class="op">)</span>,</span>
<span>                  position <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                  na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 3. Boxplot of global BMI"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"N = 181 countries"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"BMI"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Year: 2015 | Data source: WHO"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%207.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<p>What do you notice about the data from this visual check?</p>
<p>Personally, I'm concerned about those low BMI data points, BMI should never really be that low. Perhaps this is a data recording issue. No way to know without looking at the individual level data. For further analysis we may want to filter out these data points, or at least check them against other data sources.</p>
</div>
</div>
<div id="correlation-between-variables" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Correlation between variables<a class="anchor" aria-label="anchor" href="#correlation-between-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Next, let's take a look at how good <code>ggplot</code> is at making scatter plots. The following code plots number of years of schooling (on the x-axis) against life expectancy (on the y-axis) for each of our 183 countries.</p>
<p>Again, this takes the dataset and <em>pipes</em> it into ggplot. The aesthetic is years of schooling on the x-axis and life expectancy on the y-axis. The geometry layer is using <code>geom_point</code> (rather <code>geom_boxplot</code> or <code>geom_histogram</code>) which creates a scatter plot.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Schooling</span>, y <span class="op">=</span> <span class="va">Life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%208.png" width="100%" style="display: block; margin: auto;"></div>
<p>That looks to be a very clear correlation to me. In the coming weeks we'll look at strength and statistical significance of such relationships, but for now, to tidy this up, we can add the regression line (by adding an extra geometry layer of <code>geom_smooth</code>), title, and label the axes.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Schooling</span>, y <span class="op">=</span> <span class="va">Life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 2. A scatter plot of life expectancy by number of years of schooling"</span>,<span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Average number of years of schooling"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Average life expectancy (in years)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%209.png" width="100%" style="display: block; margin: auto;"></div>
<p>What happens when you change the order and put the geom_smooth before the geom_point function? <select class="webex-select"><option value="blank"></option>
<option value="">Only the dots are visable</option>
<option value="">Only the line is visable</option>
<option value="answer">The dots now appear ontop of the line</option>
<option value="">Everything brakes!</option></select></p>
<p>There are usually multiple different ways to achieve what you want to achieve with ggplot.</p>
<p>If you delete the bottom two lines of code, can you find a way to label the x and y-axes within the labs function?</p>
<div class="webex-solution">
<button>
Hint
</button>
<p>Check the code from earlier</p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Schooling</span>, y <span class="op">=</span> <span class="va">Life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 2. A scatter plot of life expectancy by number of years of schooling"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Average number of years of schooling"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Average life expectancy (in years)"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div id="adding-to-the-aestetic" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Adding to the aestetic<a class="anchor" aria-label="anchor" href="#adding-to-the-aestetic"><i class="fas fa-link"></i></a>
</h3>
<p>There is one extra thing we can do with the aesthetics part of our code for our scatter plot and that's assign colour or size to our data points.</p>
<p>The code below uses the <code>Continent</code> variable to assign colour.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Schooling</span>, y <span class="op">=</span> <span class="va">Life_exp</span>, colour <span class="op">=</span> <span class="va">Continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 3. A scatter plot of life expectancy by number of years of schooling"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Average number of years of schooling"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Average life expectancy (in years)"</span><span class="op">)</span> <span class="co"># delete aes(group = 1) &amp; ,colour = "black" to see why I included them</span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%2010.png" width="100%" style="display: block; margin: auto;"></div>
<p>The code below uses the <code>Population</code> variable to assign size to the data points. Now, the larger the population the larger the dot size.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who_rawdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Schooling</span>, y <span class="op">=</span> <span class="va">Life_exp</span>, colour <span class="op">=</span> <span class="va">Continent</span>, size <span class="op">=</span> <span class="va">Population</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Figure 3. A scatter plot of life expectancy by number of years of schooling"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Average number of years of schooling"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Average life expectancy (in years)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># delete this line to see why I included it </span></span></code></pre></div>
<div class="inline-figure"><img src="Images/week%202%20plot%2011.png" width="100%" style="display: block; margin: auto;"></div>
<p>The comments in the code also indicate parts where I had AI assistants. I couldn't remember how to make these changes off the top of my head. Googleing would have taken about 15 mins to find the right guide with the right code but my <a href="https://chat.openai.com/share/5c8c2f2e-31b8-49ac-bed1-b247198bb340">requests to ChatGPT</a> took less than a minute and also gave an explanation of how the extra code works. This is also a great example of how little the AI needs to work out what you're asking.</p>
</div>
</div>
<div id="test-yourself-exersise-3" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Test yourself exersise 3<a class="anchor" aria-label="anchor" href="#test-yourself-exersise-3"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://www.gapminder.org/">The Gapminder organisation</a> is one of my all time favourite non-profits. Their mission is to promote a fact-based worldview that everyone can understand. Never have I seen data about demography and global helath issues communicated in such an engaging way. For instance, <a href="https://www.youtube.com/watch?v=Z8t4k0Q8e8Y">here is the best 5 minutes of data communication I've ever seen</a>. Sadly, we lost the amazing Hans Rosling in 2017 but his <a href="https://twitter.com/OlaRosling">son</a> and <a href="https://twitter.com/AnnaGapminder">daughter-in-law</a> continue to do incredible work in this area and are worth following.</p>
<p>Gapminder have created an R package that contains data similar to the data we've just been using. Install the package, load the package, and import the data using the code below.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"gapminder"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gapminder_data</span> <span class="op">&lt;-</span> <span class="fu">gapminder</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gapminder/man/gapminder.html">gapminder</a></span></span></code></pre></div>
<p>By looking at the data you can likely see that there's a lot more of it this time. That's due to there also being a year variable. The code below just extracts the data for the most recent year in the dataset, 2007.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_2007</span> <span class="op">&lt;-</span> <span class="va">gapminder_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span></code></pre></div>
<p>Now play with this data! Try to adapt the code from this week and see what you can produce. Here is a list of things you could try:</p>
<ol style="list-style-type: decimal">
<li>Create histograms for life expectancy and GDP.</li>
<li>Create boxplots for life expectancy and GDP.</li>
<li>Create a simple scatter plot of life expectancy and GDP.</li>
<li>Add the continent and population size data to your scatter plot from 3.</li>
<li>Make sure each has an appropriate title and axis labels.</li>
</ol>
<p>Good luck, and feel free to share what you create on our module teams area.</p>
<hr>
<hr>
<p>This book is a work in progress. If you have any feedback or spot any mistakes please enter them into <a href="https://glos.onlinesurveys.ac.uk/r-codebook-feedback">this feedback survey</a> quoting the week your comment is referring to. Thank you! :-)</p>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script><div class="chapter-nav">
<div class="prev"><a href="week-1---writing-and-running-your-first-code.html"><span class="header-section-number">4</span> Week 1 - Writing and running your first code</a></div>
<div class="next"><a href="week-3---working-with-data-files.html"><span class="header-section-number">6</span> Week 3 - Working with data files</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#week-2---basic-visualisation"><span class="header-section-number">5</span> Week 2 - Basic visualisation</a></li>
<li>
<a class="nav-link" href="#introduction"><span class="header-section-number">5.1</span> Introduction</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#feeling-overwhelmed"><span class="header-section-number">5.1.1</span> Feeling overwhelmed?</a></li></ul>
</li>
<li><a class="nav-link" href="#getting-an-overview-of-your-data"><span class="header-section-number">5.2</span> Getting an overview of your data</a></li>
<li>
<a class="nav-link" href="#visualising-global-life-expectancy"><span class="header-section-number">5.3</span> Visualising global life expectancy</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#histograms"><span class="header-section-number">5.3.1</span> Histograms</a></li>
<li><a class="nav-link" href="#test-yourself-exercise-1"><span class="header-section-number">5.3.2</span> Test yourself exercise 1</a></li>
<li><a class="nav-link" href="#facet-wrap"><span class="header-section-number">5.3.3</span> Facet wrap</a></li>
<li><a class="nav-link" href="#boxplots"><span class="header-section-number">5.3.4</span> Boxplots</a></li>
<li><a class="nav-link" href="#test-yourself-exercise-2"><span class="header-section-number">5.3.5</span> Test yourself exercise 2</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#correlation-between-variables"><span class="header-section-number">5.4</span> Correlation between variables</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#adding-to-the-aestetic"><span class="header-section-number">5.4.1</span> Adding to the aestetic</a></li></ul>
</li>
<li><a class="nav-link" href="#test-yourself-exersise-3"><span class="header-section-number">5.5</span> Test yourself exersise 3</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>NS7154 R Workbook</strong>" was written by Dr Richard Clarke. It was last built on 2023-08-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
